---
layout: post
title: Monitoring, Auditing, Billing
date: 2018-03-26 10:08
author: tmasabari
comments: true
categories: [auditing, AWS, Monitoring &amp; logging]
---
<h3>Cloudwatch</h3>
<h4><a href="https://www.quora.com/What-is-the-difference-between-CloudTrail-and-CloudWatch">Vs Cloud trail</a> with <a href="https://stackshare.io/stackups/amazon-cloudwatch-vs-aws-cloudtrail">metrics</a></h4>
<table style="width: 745px;">
<tbody>
<tr>
<td style="width: 402px;">CloudWatch</td>
<td style="width: 317px;">CloudTrail</td>
</tr>
<tr>
<td style="width: 402px;">CloudWatch is mostly used to <strong>monitor operational health and performance</strong>, but can also provide <strong>automation</strong> via Rules which respond to state changes. used by many organisations, mostly to monitor their websites’ server</td>
<td style="width: 317px;">CloudTrail is just used to <strong>audit changes</strong> to services. enables governance, compliance and operational auditing. It is not something that most organisations use.</td>
</tr>
<tr>
<td style="width: 402px;"><b><i>Sys admin needs to know when CPU utilization reaches a certain threshold</i></b></td>
<td style="width: 317px;"><b><i>How did an unauthorized user gain access to an S3 bucket</i></b></td>
</tr>
<tr>
<td style="width: 402px;">CloudWatch can be used to monitor Cloudtrial service but not the other way around.</td>
<td style="width: 317px;"></td>
</tr>
<tr>
<td style="width: 402px;">CloudWatch is used for logging events that happen on <strong>any</strong> particular AWS service.</td>
<td style="width: 317px;">It is <strong>primarily</strong> used to <strong>monitor API calls</strong> and is <strong>applicable for a select services</strong> only</td>
</tr>
<tr>
<td style="width: 402px;">
<ul>
 	<li>it monitors AWS resources like EC2 instances, DynamoDB tables, and RDS DB instances, as well as custom metrics generated by your applications and services, and any log files your applications generate.</li>
 	<li>helps to gain system-wide visibility into resource utilization, application performance, and operational health.</li>
</ul>
</td>
<td style="width: 317px;">
<ul>
 	<li>you define amazon S3 bucket(like folder) for storage.</li>
 	<li>API activity generated.</li>
 	<li><b>CloudTrail captures and record that activity</b></li>
 	<li>that log of API call is delivered to S3 bucket and also deliver to <b>CloudWatch</b> event</li>
</ul>
</td>
</tr>
</tbody>
</table>
real time montioring ec2 rds others

system wide insights - usage of resources, performance of IT resources/applications, status of the tasks.
<ul>
 	<li>no cost
<ul>
 	<li>7 basic metrics interval 5 mins, 3 status metrics interval 1 minute</li>
</ul>
</li>
 	<li>additional cost - detailed metrics at 1 minute interval</li>
 	<li>Monitor IT - CPU, disk,data transfer rate, operational status</li>
 	<li>monitor other aws resources at no extra cost or software
<ul>
 	<li>eliminates the need of own monitoring systems</li>
</ul>
</li>
 	<li>gather track logs and metics,
<ul>
 	<li>application can generate custom metrics</li>
</ul>
</li>
 	<li>view the trends</li>
 	<li>view latest stats graphs</li>
 	<li>monitor and store the logs
<ul>
 	<li>detect any issue</li>
 	<li>troubleshoot systems and applications at any point</li>
</ul>
</li>
 	<li>set alarms of conditions,
<ul>
 	<li>set up an automated action</li>
 	<li>recieve notifications</li>
 	<li>respond to the events in the resources</li>
</ul>
</li>
 	<li>cloud watch dashboard
<ul>
 	<li>reuse the graph of custom metrics</li>
</ul>
</li>
 	<li>retain metrics data  for 2 weeks</li>
 	<li>compare the current and historic data
<ul>
 	<li>metrics
<ul>
 	<li>signiyf the performance of resources</li>
 	<li>free metrics</li>
 	<li>
<p id="zrTquUq"><img class="alignnone size-full wp-image-1233 " src="/wp-content/uploads/2018/03/img_5ab2fe5d78a3a.png" alt="" /></p>
</li>
</ul>
</li>
 	<li>metrics
<ul>
 	<li>request count, latency, cpu utilization</li>
 	<li>Custom metircs
<ul>
 	<li>memory usage, page load times error rates</li>
 	<li>provide through smple API or API request.</li>
 	<li>1 min frequestn</li>
</ul>
</li>
 	<li></li>
</ul>
</li>
 	<li>dashboard
<ul>
 	<li>search metrics</li>
 	<li>create graphs</li>
 	<li>set alarms</li>
</ul>
</li>
 	<li>Graph
<ul>
 	<li>blended graph - can show correlated behaviour / trend patterns of multiple metrics</li>
 	<li></li>
</ul>
</li>
</ul>
</li>
</ul>
<a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/monitoring/AlarmThatSendsEmail.html">alarms</a>
<p id="Xwpjheg"><img class="wp-image-1274 alignleft" src="/wp-content/uploads/2018/03/img_5ab4e1818afb8.png" alt="" width="380" height="324" /></p>

<ul>
 	<li>You can create up to 5000 alarms per region per AWS account.</li>
 	<li>set in any metric, <strong>for a specific number of period </strong></li>
 	<li>take <strong>one or more actions</strong> when metrics surpasses specific threshold, and sustained for specified number of periods</li>
 	<li><strong>periods can be 5 minutes, 15 minutes, 1 hour, 6 hours </strong>
<ul>
 	<li>involved passsing a notification to the auto scaling policy or</li>
 	<li>simple notification service or</li>
 	<li>SNS topic</li>
</ul>
</li>
 	<li>Some AWS resources <strong>do not send metric data to CloudWatch under certain conditions</strong>.For example, Amazon EBS may not send metric data for an available volume that is not attached to an Amazon EC2 instance, because there is no metric activity to be monitored for that volume. If you have an alarm set for such a metric, you may notice its state change to <strong>Insufficient Data</strong>. This <strong>may indicate that your resource is inactive, and may not necessarily mean that there is a problem</strong>.</li>
 	<li>cloud watch is <strong>not designed to monitor the actions or results</strong>
<ul>
 	<li>CloudWatch doesn't test or validate the actions that you specify, nor does it detect any Auto Scaling or Amazon SNS errors resulting from an attempt to invoke nonexistent actions. Make sure that your actions exist.</li>
</ul>
</li>
 	<li>
<p id="alarm-states">Alarm States An alarm has the following possible states:</p>

<ul>
 	<li>
<p id="alarm-states"><em style="font-size: 1rem;"><code class="code">OK</code></em><span style="font-size: 1rem;">—The metric is within the defined threshold</span></p>
</li>
 	<li>
<p id="alarm-states"><em style="font-size: 1rem;"><code class="code">ALARM</code></em><span style="font-size: 1rem;">—The metric is outside of the defined threshold</span></p>
</li>
 	<li>
<p id="alarm-states"><em style="font-size: 1rem;"><code class="code">INSUFFICIENT_DATA</code></em><span style="font-size: 1rem;">—The alarm has just started, the metric is not available, or not enough data is available for the metric to determine the alarm state</span></p>
</li>
</ul>
</li>
 	<li>You can specify how alarms handle missing data points. Choose whether to treat missing data points as:
<div class="itemizedlist">
<ul class="itemizedlist" type="disc">
 	<li class="listitem"><code class="code">missing</code> (The alarm looks back farther in time to find additional data points)</li>
 	<li class="listitem"><code class="code">notBreaching</code> (Treated as a data point that is within the threshold)</li>
 	<li class="listitem"><code class="code">breaching</code> (Treated as a data point that is breaching the threshold)</li>
 	<li class="listitem"><code class="code">ignore</code> (The current alarm state is maintained)</li>
</ul>
</div>
&nbsp;</li>
 	<li>If you set an alarm on a high-resolution metric, you can specify a high-resolution alarm with a period of 10 seconds or 30 seconds, or you can set a regular alarm with a period of any multiple of 60 seconds. There is a higher charge for high-resolution alarms.</li>
</ul>
&nbsp;
